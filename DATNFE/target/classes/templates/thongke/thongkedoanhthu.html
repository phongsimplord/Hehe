<!doctype html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Thống Kê</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
            integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js"
            integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <style>
        .custom-select-sm {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            border: none;
            background: none;
            padding: 0;
            margin: 0;
            cursor: pointer;
        }

        .stats.row {
            display: flex;
            align-items: center;
        }

        .fa-calendar-o {
            margin-right: 10px; /* Điều chỉnh khoảng cách giữa biểu tượng và chữ trong option */
        }
    </style>
</head>
<body>

<div class="wrapper d-flex align-items-stretch">
    <nav id="sidebar">
        <div class="custom-menu">
            <button type="button" id="sidebarCollapse" class="btn btn-primary">
                <i class="fa fa-bars"></i>
                <span class="sr-only">Toggle Menu</span>
            </button>
        </div>
        <div class="p-4">
            <h1><a href="kieu_dang.html" class="logo">DLFV</a></h1>
            <ul class="list-unstyled components mb-5">
                <li class="active">
                    <a href="#homeSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle"><span
                            class="fa fa-home mr-3"></span>Thống Kê</a>
                    <ul class="collapse list-unstyled" id="homeSubmenu">
                        <li>
                            <a href="/admin/thong-ke">Thông kê doanh thu</a>
                        </li>
                        <li>
                            <a href="/admin/thong-ke-top-ban-chay">Thông kê top</a>
                        </li>

                    </ul>
                </li>
                <li>
                    <a href="/admin/ban-hang" ><span class="fa fa-user mr-3"></span> Quản Lý Đơn Hàng</a>

                </li>
                <li>
                    <a href="/admin/ban-hang-tai-quay"><span class="fa fa-briefcase mr-3"></span> Bán Hàng Tại Quầy</a>
                </li>
                <li>
                    <a href="#homeSubmenu2"  data-toggle="collapse" aria-expanded="false" class="dropdown-toggle"><span class="fa fa-sticky-note mr-3"></span> Quản Lý Sản Phẩm</a>
                    <ul class="collapse list-unstyled" id="homeSubmenu2">
                        <li>
                            <a href="/admin/sanpham">Sản Phẩm</a>
                        </li>
                        <li>
                            <a href="/admin/camgiac">Cảm Giác</a>
                        </li>
                        <li>
                            <a href="/admin/chatlieu">Chất Liệu</a>
                        </li>
                        <li>
                            <a href="/admin/danhmuc">Danh Mục</a>
                        </li>
                        <li>
                            <a href="/admin/degiay">Đế Giày</a>
                        </li>
                        <li>
                            <a href="/admin/diahinh">Địa Hình</a>
                        </li>
                        <li>
                            <a href="/admin/docaogiay">Độ Cao Giày</a>
                        </li>
                        <li>
                            <a href="/admin/gioitinh">Giới Tính</a>
                        </li>
                        <li>
                            <a href="/admin/mausac">Màu Sắc</a>
                        </li>
                        <li>
                            <a href="/admin/thoitietthichhop">Thời Tiết Thích Hợp</a>
                        </li>
                        <li>
                            <a href="/admin/thuonghieu">Thương Hiệu</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#homeSubmenu3"  data-toggle="collapse" aria-expanded="false" class="dropdown-toggle"><span class="fa fa-paper-plane mr-3"></span> Quản Lý Tài Khoản</a>
                    <ul class="collapse list-unstyled" id="homeSubmenu3">
                        <li>
                            <a href="/admin/nhan-vien">Nhân Viên</a>
                        </li>
                        <li>
                            <a href="/admin/khachhang">Khách Hàng</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#homeSubmenu4"  data-toggle="collapse" aria-expanded="false" class="dropdown-toggle"><span class="fa fa-cubes mr-3"></span>Khuyến Mại</a>
                    <ul class="collapse list-unstyled" id="homeSubmenu4">
                        <li>
                            <a href="/admin/chuong-trinh-giam-gia-sp">Sản Phẩm</a>
                        </li>
                        <li>
                            <a href="/admin/giamgiahoadon">Hóa Đơn</a>
                        </li>
                    </ul>
                </li>
            </ul>

            <div class="mb-5">
                <h3 class="h6 mb-3">Subscribe for newsletter</h3>
                <form action="#" class="subscribe-form">
                    <div class="form-group d-flex">
                        <div class="icon"><span class="icon-paper-plane"></span></div>
                        <input type="text" class="form-control" placeholder="Enter Email Address">
                    </div>
                </form>
            </div>

            <div class="footer">
                <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib.com</a>
                    <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
            </div>

        </div>
    </nav>

    <!-- Page Content  -->

    <div id="content" class="p-4 p-md-5 pt-5">
        <nav class="navbar navbar-expand-lg navbar-light bg-light" style="margin-top: -50px;">
            <div class="container-fluid" style="display: flex;justify-content: end;">
                <ul class="navbar-nav">
                    <!-- Avatar -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#"
                           id="navbarDropdownMenuLink"
                           role="button" data-toggle="dropdown" aria-expanded="false">
                            <img src="https://mdbcdn.b-cdn.net/img/Photos/Avatars/img (31).webp" class="rounded-circle"
                                 height="72" alt="Avatar" loading="lazy"/>
                        </a>
                        <div class="dropdown-menu" style="margin-left: -88px;">
                            <a class="dropdown-item" href="#">Đăng Xuất</a>
                            <a class="dropdown-item" href="#">Thông Tin Cá Nhân</a>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="container bg-light" style="border: 2px solid #ccc; padding: 20px; border-radius: 10px;">
            <div class="row">
                <!--                Begin card Tổng doanh thu bán hàng-->
                <div class="col-lg-6 col-md-6 col-sm-6">
                    <div class="card card-stats">
                        <div class="card-body ">
                            <div class="row">
                                <div class="col-5 col-md-4">
                                    <div class="icon-big text-center icon-warning">
                                        <i class="bi bi-cash-coin"></i>
                                    </div>
                                </div>
                                <div class="col-7 col-md-8">
                                    <div class="numbers">
                                        <h6 class="card-category">Tổng Doanh Thu Bán Hàng</h6>
                                        <p th:class="giaBan" class="card-title" th:text="${tongTien}">
                                        <p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <hr>
                            <div class="stats row">
                                <i class="fa fa-calendar-o col-1"></i>
                                <form th:action="@{/admin/thong-ke/doanh-thu-ban-hang}" method="get">
                                    <select id="thoi-gian-select1" class="custom-select-sm col-12" name="thoiGian">
                                        <option th:selected="${ngayDaChonDoanhThuDetail == 'ngay'}" value="ngay">Trong ngày
                                        </option>
                                        <option th:selected="${ngayDaChonDoanhThuDetail == 'tuan'}" value="tuan">Trong tuần
                                        </option>
                                        <option th:selected="${ngayDaChonDoanhThuDetail == 'thang'}" value="thang">Trong tháng
                                        </option>
                                        <option th:selected="${ngayDaChonDoanhThuDetail == 'nam'}" value="nam">Trong năm
                                        </option>
                                    </select>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <!--                End card Tổng doanh thu bán hàng-->

                <!--                Begin Tổng lợi nhuận bán hàng-->
                <div class="col-lg-6 col-md-6 col-sm-6">
                    <div class="card card-stats">
                        <div class="card-body ">
                            <div class="row">
                                <div class="col-5 col-md-4">
                                    <div class="icon-big text-center icon-warning">
                                        <i class="bi bi-cash-coin"></i>
                                    </div>
                                </div>
                                <div class="col-7 col-md-8">
                                    <div class="numbers">
                                        <h6 class="card-category">Tổng Lợi Nhuận Bán Hàng</h6>
                                        <p th:class="giaBan" class="card-title">
                                            [[${tongLoiNhuan}]]
                                        <p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <hr>
                            <div class="stats row">
                                <i class="fa fa-calendar-o col-1"></i>
                                <form th:action="@{/admin/thong-ke/loi-nhuan-ban-hang}" method="get">
                                    <select id="thoi-gian-select2" class="custom-select-sm col-12" name="thoiGian">
                                        <option th:selected="${ngayDaChonLoiNhuanDetail == 'ngay'}" value="ngay">Trong ngày
                                        </option>
                                        <option th:selected="${ngayDaChonLoiNhuanDetail == 'tuan'}" value="tuan">Trong tuần
                                        </option>
                                        <option th:selected="${ngayDaChonLoiNhuanDetail == 'thang'}" value="thang">Trong tháng
                                        </option>
                                        <option th:selected="${ngayDaChonLoiNhuanDetail == 'nam'}" value="nam">Trong năm
                                        </option>
                                    </select>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <!--                End Tổng lợi nhuận báng hàng-->
                <div class="col-lg-3 col-md-6 col-sm-6" style="margin-top: 25px">
                    <div class="card card-stats">
                        <div class="card-body ">
                            <div class="row">
                                <div class="col-5 col-md-4">
                                    <div class="icon-big text-center icon-warning">
                                        <i class="bi bi-cash-coin"></i>
                                    </div>
                                </div>
                                <div class="col-7 col-md-8">
                                    <div class="numbers">
                                        <p class="card-category">Doanh Thu</p>
                                        <p th:class="giaBan" class="card-title" th:text="${tongTienTrongNgay != null ? tongTienTrongNgay : 0}">
                                        <p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <hr>
                            <div class="stats">
                                <i class="fa fa-calendar-o"></i>
                                Ngày Hôm nay
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6" style="margin-top: 25px">
                    <div class="card card-stats">
                        <div class="card-body ">
                            <div class="row">
                                <div class="col-5 col-md-4">
                                    <div class="icon-big text-center icon-warning">
                                        <i class="bi bi-file-earmark-play"></i>
                                    </div>
                                </div>
                                <div class="col-7 col-md-8">
                                    <div class="numbers">
                                        <p class="card-category">Chờ Xác Nhận</p>
                                        <p class="card-title">
                                            [[${tongsohoadondangchoxanhan}]]
                                        <p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer ">
                            <hr>
                            <div class="stats">
                                <i class="fa fa-refresh"></i>
                                Đơn Mua Chờ Xác Nhận
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6" style="margin-top: 25px">
                    <div class="card card-stats">
                        <div class="card-body ">
                            <div class="row">
                                <div class="col-5 col-md-4">
                                    <div class="icon-big text-center icon-warning">
                                        <i class="bi bi-file-earmark-excel"></i>
                                    </div>
                                </div>
                                <div class="col-7 col-md-8">
                                    <div class="numbers">
                                        <p class="card-category">Đã Hủy</p>
                                        <p class="card-title">[[${tongSoHoaDonDaHuy}]]
                                        <p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer ">
                            <hr>
                            <div class="stats">
                                <i class="fa fa-clock-o"></i>
                                Đơn Hàng Đã Hủy
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6" style="margin-top: 25px">
                    <div class="card card-stats">
                        <div class="card-body ">
                            <div class="row">
                                <div class="col-5 col-md-4">
                                    <div class="icon-big text-center icon-warning">
                                        <i class="bi bi-file-earmark-check"></i>
                                    </div>
                                </div>
                                <div class="col-7 col-md-8">
                                    <div class="numbers">
                                        <p class="card-category">Đã hoàn thành</p>
                                        <p class="card-title">[[${tongSoHoaDonDaHoanThanh}]]
                                        <p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer ">
                            <hr>
                            <div class="stats">
                                <i class="fa fa-refresh"></i>
                                Đơn Hàng Đã Hoàn Thành
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <br>
            <div class="row">
                <div class="col-md-4">
                    <div class="card ">
                        <div class="card-header ">
                            <h5 class="card-title">Thống kê Đơn</h5>
                            <p class="card-category">Hiệu Xuất Kiểu Người Mua</p>
                        </div>
                        <div class="card-body ">
                            <canvas id="chartkieumua"></canvas>
                        </div>
                        <div class="card-footer ">
                            <div class="stats">
                                <i class="fa fa-calendar"></i> Số Lượng Người Mua
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="card card-chart">
                        <div class="card-header">
                            <h5 class="card-title">Biểu Đồ Doanh Thu Hàng Tháng Trong
                                <script th:if="${nam == null}">
                                    document.write(new Date().getFullYear())
                                </script>
                                <span th:if="${nam !=null}"> [[${nam}]]</span>
                            </h5>
                            <p class="card-category">Biểu Đồ Đường Có Điểm</p>
                        </div>
                        <div class="card-body">
                            <canvas id="speedChart" width="400" height="140"></canvas>
                        </div>
                        <div class="card-footer">
                            <div class="chart-legend">
                                <i class="fa fa-circle text-warning"></i> Doanh Thu
                                <i class="fa fa-circle text-info"></i> Doanh Thu Lợi Nhuận
                            </div>
                            <hr/>
                            <div class="card-stats">
                                <form th:action="@{/admin/thong-ke/bieu-do-doanh-thu-hang-trong-nam}"  method="get">
                                    <i class="fa fa-check"></i>
                                    <label for="chon-nam">Chọn năm:</label>
                                    <select  id="chon-nam" name="chon-nam">
                                        <option value="">Chọn năm</option>
                                    </select>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<!--Định dạng số tiền VNĐ-->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var giaBanElements = document.querySelectorAll('.giaBan');
        giaBanElements.forEach(function (element) {
            var giaBanText = element.textContent.trim();
            var giaBan = parseFloat(giaBanText.replace('Giá Bán:', '').trim());
            var giaBanFormatted = giaBan.toLocaleString('vi-VN'); // Định dạng giá

            // Cập nhật lại văn bản đã định dạng trong phần tử
            element.textContent = giaBanFormatted + " VNĐ";
        });
    });
</script>
<!--End định dạng số tiền VNĐ-->


<script th:inline="javascript">
    var tongsomuaon =  [[${TongOn}]];
    var tongsomuatructiep =  [[${Tongtructiep}]];

    var tongtientrongnam = [[${jsonData}]];
    var tongtienloinhauhangthangtrongnam = [[${jsonData1}]];
</script>

<!--Biểu đồ tròn hiện thị kiểu người mua-->
<script>
    var ctx = document.getElementById('chartkieumua').getContext("2d");

    var myChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Trực Tiếp', 'Online'],
            datasets: [{
                pointRadius: 0,
                pointHoverRadius: 0,
                backgroundColor: [
                    '#e3e3e3',
                    '#007bff'
                ],
                borderWidth: 0,
                data: [tongsomuaon, tongsomuatructiep]
            }]
        },

        options: {
            legend: {
                display: false
            },
            pieceLabel: {
                render: 'percentage',
                fontColor: ['white'],
                precision: 2
            },
            tooltips: {
                enabled: false
            },
            scales: {
                yAxes: [{
                    ticks: {
                        display: false
                    },
                    gridLines: {
                        drawBorder: false,
                        zeroLineColor: "transparent",
                        color: 'rgba(255,255,255,0.05)'
                    }
                }],
                xAxes: [{
                    barPercentage: 1.6,
                    gridLines: {
                        drawBorder: false,
                        color: 'rgba(255,255,255,0.1)',
                        zeroLineColor: "transparent"
                    },
                    ticks: {
                        display: false,
                    }
                }]
            },
        }
    });
</script>

<!--Biểu đồ đường hiện thị doanh thu theo tháng trong năm-->
<script>

    console.log(tongtienloinhauhangthangtrongnam)
    var speedCanvas = document.getElementById("speedChart");
    var vitri_x = tongtientrongnam.map(x => "Tháng " + x[0])
    var vitri_y = tongtientrongnam.map(x => x[1])

    var vitri1_y = tongtienloinhauhangthangtrongnam.map(x => x[2])

    var monthlyTotalData = {
        data: vitri_y, // Số liệu tổng tiền hàng tháng
        fill: false,
        borderColor: '#fbc658',
        backgroundColor: 'transparent',
        pointBorderColor: '#fbc658',
        pointRadius: 4,
        pointHoverRadius: 4,
        pointBorderWidth: 8,
        label: 'Doanh thu'
    };

    var monthlyTotalData1 = {
        data: vitri1_y, // Số liệu tổng tiền hàng tháng
        fill: false,
        borderColor: '#51CACF',
        backgroundColor: 'transparent',
        pointBorderColor: '#51CACF',
        pointRadius: 4,
        pointHoverRadius: 4,
        pointBorderWidth: 8,
        label: 'Doanh thu lợi nhậu'
    };

    var speedData = {
        labels: vitri_x,
        datasets: [monthlyTotalData,monthlyTotalData1]
    };

    var chartOptions = {
        legend: {
            display: false,
            position: 'top'
        }
    };

    var lineChart = new Chart(speedCanvas, {
        type: 'line',
        hover: false,
        data: speedData,
        options: chartOptions
    });
</script>

<!--select thời gian mình chọn-->
<script>
    document.getElementById('thoi-gian-select1').addEventListener('change', function () {
        this.form.submit();
    });

    document.getElementById('thoi-gian-select2').addEventListener('change', function () {
        this.form.submit();
    });

    document.getElementById('chon-nam').addEventListener('change', function () {
        this.form.submit();
    });
</script>

<!--Lấy tất cả năm -->
<script>
    // Lấy năm hiện tại
    var namHienTai = new Date().getFullYear();

    // Tạo danh sách các năm từ năm hiện tại đến 100 năm trước đó
    for (var i = namHienTai; i >= namHienTai - 100; i--) {
        var option = document.createElement('option');
        option.value = i;
        option.text = i;
        document.getElementById('chon-nam').appendChild(option);
    }
</script>


<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/popper.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/main.js"></script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa"
        crossorigin="anonymous"></script>
</body>
</html>